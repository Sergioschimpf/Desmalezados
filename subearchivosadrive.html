<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subir archivos a Drive</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f2f5; color: #333; }
  header { background: #2e7d32; color: white; text-align: center; padding: 15px; position: relative; }
  h1 { margin: 0; font-size: 1.5em; }
  section { max-width: 600px; margin: 30px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
  button { margin: 10px; padding: 10px 20px; background: #1b5e20; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer; transition: background 0.3s; }
  button:hover { background: #388e3c; }
  input[type=file] { margin: 15px 0; }
  #success-banner { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #4CAF50; color: white; padding: 12px 20px; border-radius: 6px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); font-size: 1.1em; z-index: 9999; }
</style>
</head>
<body>
<div id="success-banner">Archivo subido exitosamente</div>

<header>
  <h1>Subida de Archivos a Drive</h1>
</header>

<section>
  <button onclick="initLogin()">Iniciar sesi칩n con Google</button>

  <div>
    <h3>Bit치cora</h3>
    <input type="file" id="upload-bitacora">
    <button onclick="handleUpload('Bitacora')">Subir</button>
  </div>

  <div>
    <h3>Desmalezado</h3>
    <input type="file" id="upload-desmalezado">
    <button onclick="handleUpload('Desmalezado')">Subir</button>
  </div>

  <div>
    <h3>Relevamiento</h3>
    <input type="file" id="upload-relevamiento">
    <button onclick="handleUpload('Relevamiento')">Subir</button>
  </div>
</section>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
const CLIENT_ID = "97793571405-f6ggo2qia339e71k8gg79s54pot0u5t5.apps.googleusercontent.com";
const SCOPES = "https://www.googleapis.com/auth/drive.file";

const FOLDER_IDS = {
  "Bitacora": "1K4Zz8YQhkxbtqtLm_kbUQe_I75HXslYC",
  "Desmalezado": "1Fq42JQThD2knm-2mrxtArCGY96KYQz59",
  "Relevamiento": "1uDnC7krR2eUpaG4y6AzmIgfvJk6jOVJR"
};

let selectedFiles = { Bitacora: null, Desmalezado: null, Relevamiento: null };
let accessToken = null;
let tokenClient = null;

function showSuccessBanner() {
  const banner = document.getElementById('success-banner');
  banner.style.display = 'block';
  setTimeout(() => banner.style.display = 'none', 3000);
}

function initLogin() {
  if (!tokenClient) {
    tokenClient = google.accounts.oauth2.initTokenClient({
      client_id: CLIENT_ID,
      scope: SCOPES,
      callback: (resp) => {
        if (resp.error) {
          console.error(resp);
          return;
        }
        accessToken = resp.access_token;
        alert("Sesi칩n iniciada correctamente");
      }
    });
  }
  // Esto pide token (si no lo tiene) o lo renueva
  tokenClient.requestAccessToken();
}

function handleUpload(tipo) {
  if (!accessToken) {
    alert("Primero inicia sesi칩n");
    return;
  }
  const file = selectedFiles[tipo];
  if (!file) {
    alert("Selecciona un archivo.");
    return;
  }

  const metadata = {
    name: `${tipo}_${file.name}`,
    mimeType: file.type,
    parents: [FOLDER_IDS[tipo]]
  };

  const form = new FormData();
  form.append("metadata", new Blob([JSON.stringify(metadata)], {type: "application/json"}));
  form.append("file", file);

  fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
    method: "POST",
    headers: new Headers({ "Authorization": "Bearer " + accessToken }),
    body: form
  })
  .then(r => r.json())
  .then(() => { showSuccessBanner(); })
  .catch(err => console.error(err));
}

window.onload = () => {
  document.getElementById('upload-bitacora').addEventListener('change', e => selectedFiles.Bitacora = e.target.files[0]);
  document.getElementById('upload-desmalezado').addEventListener('change', e => selectedFiles.Desmalezado = e.target.files[0]);
  document.getElementById('upload-relevamiento').addEventListener('change', e => selectedFiles.Relevamiento = e.target.files[0]);
};
</script>
</body>
</html>


